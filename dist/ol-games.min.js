/**
 * ol-games - Game stuff for ol, powered by HTML5, canvas, javascript and Openlayers.
 * @description ol,openlayers,ol-ext,gamer,gameloop,animation,sprite,media,audio
 * @version v1.0.4
 * @author Jean-Marc Viglino
 * @see https://github.com/Viglino/ol-games
 * @license BSD-3-Clause
 */
ol.control.FrameRate=class extends ol.control.Control{constructor(t){var e=t||{},i=ol.ext.element.create("DIV",{className:(e.className||"ol-framerate")+(e.target?"":" ol-unselectable ol-control")});super({element:i,target:e.target});var s=this.canvas_=document.createElement("canvas");s.width=100,s.height=40,i.appendChild(s),this.ctx=s.getContext("2d"),this.ctx.font="bold 11px sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="top",this.ctx.fillStyle="#fff",this.ctx.fillRect(1,15,99,45)}setMap(t){this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,ol.control.Control.prototype.setMap.call(this,t),this.getMap()&&(this._listener=this.getMap().on("precompose",this.update_.bind(this)),this.time_=(new Date).getTime())}update_(t){var e=t.frameState.time-this.time;this.time=t.frameState.time,this.ctx.drawImage(this.canvas_,1,15,99,this.canvas_.height,0,15,99,this.canvas_.height);var i=Math.round(500/e);this.ctx.clearRect(0,0,100,15),this.ctx.fillStyle="#000",this.ctx.fillText(2*i+" fps",50,0),this.ctx.strokeStyle="#fff",this.ctx.beginPath(),this.ctx.moveTo(100,15),this.ctx.lineTo(100,40),this.ctx.closePath(),this.ctx.stroke(),this.ctx.strokeStyle=i>20?"#060":i>12?"#f80":"#800",this.ctx.beginPath(),this.ctx.moveTo(100,40-i/2),this.ctx.lineTo(100,40),this.ctx.closePath(),this.ctx.stroke()}},Math.sign||(Math.sign=function(t){return(t=Number(t))?t>0?1:-1:t}),Math.trunc||(Math.trunc=function(t){return t<0?Math.ceil(t):Math.floor(t)}),ol.Sprite=class extends ol.Feature{constructor(t){t=t||{};var e=new ol.geom.Point(t.position||[0,0]);super(e),this.coord=e,this.style=new ol.style.Style({image:new ol.style.Sprite(t),text:new ol.style.Text({font:"bold 12px helvetica,sans-serif",text:t.name||"",offsetY:-(t.size||64)/2*t.scale,textBaseline:"alphabetic",stroke:new ol.style.Stroke({color:[255,255,255,.5],width:5}),fill:new ol.style.Fill({color:"#333"})})}),this.setStyle([this.style]),this.image=this.style.getImage(),this.frate=t.frameRate||100,this.currentState="idle",this.startState=0,this.speed=0,this.dir=[0,0]}setName(t){this.style.getText().setText(t),this.changed()}setCoordinate(t){this.coord.setCoordinates(t)}getCoordinate(){return this.coord.getCoordinates()}setGeometry(t){this.coord=t,ol.Feature.prototype.setGeometry.call(this,t)}getImage(){return this.image}setRotation(t){this.style.getImage().setRotation(t),this.changed()}getRotation(){return this.style.getImage().getRotation()}setScale(t){this.style.getImage().setScale(t),this.changed()}getScale(){return this.style.getImage().getScale()}getBBox(t){var e=this.getCoordinate(),i=this.image.size*this.image.getScale()*t/2;return[e[0]-i,e[1]-i,e[0]+i,e[1]+i]}setState(t,e){return this.currentState=t,this.startState=e||(new Date).getTime(),this.dispatchEvent({type:"state",state:this.currentState,end:!1}),this.endState=!1,this.image.setState(this.currentState,0)}update(t){var e=this.image.setState(this.currentState,(t.frameState.time-this.startState)/this.frate);return e&&!this.endState&&(this.dispatchEvent({type:"state",state:this.currentState,end:!0}),this.endState=!0),e}setPath(t,e){null!=e&&(this.speed=e),t&&t.length&&(this.path=t,this.destination=1,this.moving_=!0,this.angle=Math.atan2(this.path[1][0]-this.path[0][0],this.path[1][1]-this.path[0][1]),this.dir=[Math.sin(this.angle),Math.cos(this.angle)],this.setCoordinate(this.path[0]),this.dispatchEvent({type:"change:direction",angle:this.angle}))}setDestination(t,e){this.setPath([this.getCoordinate(),t],e)}setDirection(t,e){this.destination=!1,this.moving_=!0,null!=e&&(this.speed=e),this.angle=t,this.dir=[Math.sin(this.angle),Math.cos(this.angle)],this.dispatchEvent({type:"change:direction",angle:this.angle})}getQuarter(){switch((Math.round(2*this.angle/Math.PI)+4)%4){case 0:return"N";case 1:return"E";case 2:return"S";case 3:return"W"}}moving(){return this.moving_}stop(){this.moving_=!1}restart(){this.moving_=!0}move(t){if(this.moving_){var e=this.getCoordinate(),i=[this.speed*this.dir[0]*t.dt,this.speed*this.dir[1]*t.dt];if(e[0]+=i[0],e[1]+=i[1],this.destination){var s=this.path[this.destination][0]-e[0],a=this.path[this.destination][1]-e[1];if(s&&Math.sign(s)!=Math.sign(this.dir[0])||a&&Math.sign(a)!=Math.sign(this.dir[1]))if(this.destination++,this.destination>=this.path.length)this.stop(),this.setCoordinate(this.path[this.destination-1]),this.destination=0,this.dispatchEvent({type:"destination"});else{for(var o=ol.coordinate.dist2d(e,this.path[this.destination-1]);;){var r=ol.coordinate.dist2d(this.path[this.destination],this.path[this.destination-1]);if(r>o)break;if(o-=r,this.destination++,this.destination>=this.path.length)return this.stop(),this.setCoordinate(this.path[this.destination-1]),this.destination=0,void this.dispatchEvent({type:"destination"})}this.setCoordinate(this.path[this.destination-1]),this.angle=Math.atan2(this.path[this.destination][0]-this.path[this.destination-1][0],this.path[this.destination][1]-this.path[this.destination-1][1]),this.dir=[Math.sin(this.angle),Math.cos(this.angle)],this.dispatchEvent({type:"change:direction",angle:this.angle}),this.move({type:t.type,dt:o/this.speed,frameState:t.frameState})}else this.setCoordinate(e)}else this.setCoordinate(e)}this.update(t)}setSpeed(t){this.speed=t}getSpeed(){return this.speed}},ol.featureAnimation.Explode=class extends ol.featureAnimation{constructor(t){super(t=t||{}),this.radius=t.radius||50;var e=document.createElement("canvas");e.width=e.height=10;var i=e.getContext("2d"),s=this.gradient=i.createRadialGradient(0,0,0,0,0,this.radius);function a(t,e){return t*e/255|0}var o=ol.color.asArray(t.color||"#ebb"),r=o[0],n=o[1],h=o[2],l=o[3];s.addColorStop(0,"rgba("+[a(r,255),a(n,255),a(h,255),l]+")"),s.addColorStop(.3,"rgba("+[a(r,254),a(n,239),a(h,29),l]+")"),s.addColorStop(.4,"rgba("+[a(r,254),a(n,88),a(h,29),l]+")"),s.addColorStop(.6,"rgba("+[a(r,239),a(n,27),a(h,51),.05*l]+")"),s.addColorStop(.88,"rgba("+[a(r,153),a(n,10),a(h,27),.05*l]+")"),s.addColorStop(.92,"rgba("+[a(r,254),a(n,39),a(h,17),.1*l]+")"),s.addColorStop(.98,"rgba("+[a(r,254),a(n,254),a(h,183),.2*l]+")"),s.addColorStop(1,"rgba("+[a(r,254),a(n,39),a(h,17),0]+")");var d=t.dispersion||this.radius/2;this.particules=[{tmin:0,dt:1,radius:this.radius,x:0,y:0}];for(var g=t.length||12,c=0;c<g;c++)this.particules.push({tmin:.4*Math.random(),dt:.3+.3*Math.random(),radius:this.radius*(.5+.5*Math.random()),x:d*(Math.random()-.5),y:d*(Math.random()-.5)})}animate(t){var e=this.easing_(t.elapsed);if(e){t.context.save();var i,s,a=t.frameState.pixelRatio,o=t.frameState.coordinateToPixelTransform,r=o[0]*t.coord[0]+o[1]*t.coord[1]+o[4],n=o[2]*t.coord[0]+o[3]*t.coord[1]+o[5],h=t.inversePixelTransform;if(h){var l=[r*h[0]-n*h[1]+h[4],-r*h[2]+n*h[3]+h[5]];r=l[0],n=l[1],a=1}t.context.globalCompositeOperation="lighter",t.context.fillStyle=this.gradient,t.context.scale(a,a);for(var d,g=0;d=this.particules[g];g++)(i=(e-d.tmin)/d.dt)>0&&i<=1&&(t.context.save(),t.context.translate(r+d.x,n+d.y),s=i*d.radius/this.radius,t.context.scale(s,s),t.context.globalAlpha=1-i,t.context.fillRect(-d.radius,-d.radius,2*d.radius,2*d.radius),t.context.restore());t.context.restore()}return t.time<=this.duration_}},ol.Backscreen=function(t){t=t||{},ol.Object.call(this);var e=this.element=document.createElement("div");e.style.position="relative",e.style.top=e.style.left="0px",e.style.top="-100%",e.style.width=t.map.getSize()[0]+"px",e.style.height=t.map.getSize()[1]+"px",e.style["z-index"]=0,e.className="ol-games-backscreen";var i=t.pixelRatio||window.devicePixelRatio;this.offmap=new ol.Map({target:e,pixelRatio:i,controls:[],interactions:[],layers:t.layers}),this.offmap.set("pixelRatio",i),this.setMap(t.map),this.image=this.offmap.getViewport().children[0],this.canvas=document.createElement("canvas")},ol.ext.inherits(ol.Backscreen,ol.Object),ol.Backscreen.prototype.setMap=function(t){this.map&&(this.map.getTargetElement().removeChild(this.element),this.offmap.setView(null)),this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,this.map=t,this.map&&(this.map.getTargetElement().appendChild(this.element),this.map.getViewport().style["z-index"]||(this.map.getViewport().style["z-index"]=1),this._listener=this.map.on("change:size",this.changeSize_.bind(this)),this.offmap.setSize(this.map.getSize()),this.offmap.setView(this.map.getView()))},ol.Backscreen.prototype.getImage=function(){return this.image},ol.Backscreen.prototype.changeSize_=function(){this.element.style.width=this.map.getSize()[0]+"px",this.element.style.height=this.map.getSize()[1]+"px"},ol.Collision=class extends ol.Object{constructor(t){super(),this.game=t.game,this.resample=t.resample||1,this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=32,this.sprites=t.sprites||[],this.targets=t.targets||[]}getImage(){return this.canvas}overflow(t){if(!this.game.frameState)return!1;var e=this.game.frameState.extent,i=t.getBBox(this.game.frameState.viewState.resolution);return e[0]>i[0]?"E":e[1]>i[1]?"N":e[2]<i[2]?"W":e[3]<i[3]&&"S"}getPixel(t){var e=this.game.frameState.coordinateToPixelTransform;return[e[0]*t[0]+e[1]*t[1]+e[4],e[2]*t[0]+e[3]*t[1]+e[5]]}dispatch(){if(this.game.frameState)for(var t=this.sprites.length,e=0;e<t-1;e++)for(var i=e+1;i<t;i++){var s=this.collide(this.sprites[e],this.sprites[i]);s&&(this.sprites[e].dispatchEvent({type:"collide",sprite:this.sprites[i],hit:s}),this.sprites[i].dispatchEvent({type:"collide",sprite:this.sprites[e],hit:s}))}}collide(t,e){if(!this.game.frameState)return!1;var i=t.getBBox(this.game.frameState.viewState.resolution),s=e.getBBox(this.game.frameState.viewState.resolution);if(!ol.extent.intersects(i,s))return!1;var a=this.getPixel(i),o=this.getPixel(s),r=this.resample,n=Math.trunc(t.getImage().size*t.getImage().getScale()/r),h=this.canvas;h.width=h.height=n;var l=h.getContext("2d");l.save(),l.globalCompositeOperation="copy",l.fillStyle="#FFF",l.fillRect(0,0,n,n),l.globalCompositeOperation="destination-out",l.drawImage(t.getImage().getImage(),0,0,t.getImage().size,t.getImage().size,0,0,n,n),l.globalCompositeOperation="source-out",l.translate((o[0]-a[0])/r,(o[1]-a[1])/r),l.drawImage(e.getImage().getImage(),0,0,e.getImage().size,e.getImage().size,0,0,n,n),l.restore();for(var d=l.getImageData(0,0,n,n),g=3;g<d.data.length;g+=4)if(d.data[g]>0){var c=g/4/n|0;return[(g/4-c*n|0)*r,c*r]}}},ol.Game=class extends ol.Object{constructor(t){t=t||{},super();var e=t.map||new ol.Map({target:t.target,loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,view:new ol.View({zoom:t.zoom,center:t.center}),interactions:[],controls:[],layers:t.layers});if(t.controls)for(var i=0;i<t.controls.length;i++)e.addControl(t.controls[i]);this.setMap(e),this.pause_=!0,this.collisions=[],this.collision=new ol.Collision({game:this,resample:t.collisionResample})}setMap(t){this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,this.map=t,this.map&&(this._listener=this.map.on("postcompose",this.anim_.bind(this)))}getMap(){return this.map}getView(){return this.map.getView()}addControl(t){return this.map.addControl(t)}collide(t,e){return this.collision.collide(t,e)}start(){this.time=(new Date).getTime(),this.pause_=!1,this.map.render(),this.dispatchEvent({type:"start"})}pause(){this.pause_=!0,this.dispatchEvent({type:"pause"})}paused(){return this.pause_}addCollision(t){t instanceof Array||(t=[t]),this.collisions=this.collisions.concat(t)}anim_(t){if(t.dt=t.frameState.time-this.time,this.time=t.frameState.time,this.frameState=t.frameState,!this.pause_){for(var e=this.collisions.length-1;e>=0;e--)this.collisions[e].dispatch();this.dispatchEvent({type:"render",context:t.context,dt:t.dt,frameState:t.frameState,vectorContext:t.vectorContext}),this.map.render()}}timer(t){this._time&&!0!==t?console.log("[TIMER] "+(new Date-this._time)+" : "+(t||"timer")):console.log("[TIMER] start"),this._time=new Date}},ol.Offscreen=class extends ol.Object{constructor(t){t=t||{},super();var e=this.element=document.createElement("div");e.style.position="absolute",e.style.opacity=0,e.style.visibility="hidden",e.style.top=e.style.left="-100000px",e.style.width=t.map.getSize()[0]+"px",e.style.height=t.map.getSize()[1]+"px",e.className="ol-games-offscreen";var i=t.pixelRatio||1;this.offmap=new ol.Map({target:e,pixelRatio:i,controls:[],interactions:[],layers:t.layers}),this.offmap.set("pixelRatio",i),this.setMap(t.map),this.resample=t.resample||1,this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=32}setMap(t){this.map&&(this.map.getViewport().removeChild(this.element),this.offmap.setView(null)),this._listener&&ol.Observable.unByKey(this._listener),this._listener=null,this.map=t,this.map&&(this.map.getViewport().appendChild(this.element),this._listener=this.map.on("change:size",this.changeSize_.bind(this)),this.offmap.setSize(this.map.getSize()),this.offmap.setView(this.map.getView()))}getImage(){var t=this.offmap.getViewport().querySelector("canvas");return t||(t=document.createElement("CANVAS")),t}changeSize_(){this.element.style.width=this.map.getSize()[0]+"px",this.element.style.height=this.map.getSize()[1]+"px"}getPixelValue(t){var e=null;return this.offmap.forEachLayerAtPixel(t,function(t,i){if(t&&i)return e=i,!0}),e}getValue(t){return this.getPixelValue(this.offmap.getPixelFromCoordinate(t))}collide(t){var e=this.offmap.get("pixelRatio"),i=t.getBBox(this.map.getView().getResolution()),s=this.map.getView().calculateExtent(this.map.getSize());if(!ol.extent.intersects(i,s))return!1;var a=this.map.getPixelFromCoordinate(i);if(!a)return!1;var o=this.resample,r=Math.trunc(t.getImage().size*t.getImage().getScale()/o),n=r*o*e,h=this.canvas;h.width!=r&&(h.width=h.height=r);var l=h.getContext("2d");l.save(),l.globalCompositeOperation="copy",l.fillStyle="#FFF",l.fillRect(0,0,r,r),l.globalCompositeOperation="destination-out",l.drawImage(t.getImage().getImage(),0,0,t.getImage().size,t.getImage().size,0,0,r,r),l.globalCompositeOperation="source-out",l.drawImage(this.getImage(),a[0]*e,a[1]*e-n,n,n,0,0,r,r),l.restore();for(var d=l.getImageData(0,0,r,r),g=3;g<d.data.length;g+=4)if(d.data[g]>0){var c=g/4/r|0;return[(g/4-c*r|0)*o,c*o]}return!1}},ol.graph.Vector=class extends ol.Object{constructor(t){super(t=t||{}),this.edges=t.source||new ol.source.Vector({useSpatialIndex:!0}),this.edges.on("changefeature",this.changeEdge.bind(this)),this.edges.on("addfeature",this.addEdge.bind(this)),this.edges.on("removefeature",this.removeEdge.bind(this))}getSource(){return this.edges}changeEdge(){}addEdge(){}removeEdge(){}getConnections(t,e,i){for(var s,a=t.getCoordinates?t.getCoordinates():t,o=this.edges.getFeaturesInExtent([a[0]-1,a[1]-1,a[0]+1,a[1]+1]),r=e?{in:[],out:[]}:[],n=0;s=o[n];n++)i&&!i(s)||(ol.coordinate.equal(a,s.getGeometry().getFirstCoordinate())?e?r.out.push(s):r.push(s):ol.coordinate.equal(a,s.getGeometry().getLastCoordinate())&&(e?r.in.push(s):r.push(s)));return r}getConnected(t,e){var i=[],s=function(e){return e===t};return i[0]=this.getConnections(t.getGeometry().getFirstCoordinate(),e,s),i[1]=this.getConnections(t.getGeometry().getLastCoordinate(),e,s),i}filterEdge(t){return"LineString"===t.getGeometry().getType()}isEdge(t){return"LineString"!==t.getGeometry().getType()}getNN(t,e){var i;if(e){var s=this.edges.getFeaturesInExtent([t[0]-e,t[1]-e,t[0]+e,t[1]+e]),a=1/0;s.forEach(function(e){var s=e.getGeometry().getClosestPoint(t),o=ol.coordinate.dist2d(s,t);o<a&&(a=o,i=e)}),a>e&&(i=null)}else for(var o=1;o<1e10&&!(i=this.getNN(t,o));o*=10);return i}},ol.media={},ol.media.Media=class extends ol.Object{constructor(t){t=t||{},super();var e=this;for(var i in this.media=t.media,t.loop&&this.setLoop(t.loop),this.media.addEventListener("canplaythrough",function(){e.dispatchEvent({type:"ready"})},!1),{load:1,play:1,pause:1,ended:1})this.media.addEventListener(i,function(t){e.dispatchEvent({type:t.type})})}play(t){void 0!==t&&(this.media.pause(),this.media.currentTime=t);var e=this.media.play();void 0!==e&&e.then(function(){}).catch(function(){console.log("Unable to play soud... Let a UI element start before play...")})}pause(){this.media.pause()}stop(){this.media.pause(),this.media.currentTime=0}setVolume(t){this.media.volume=t}getVolume(){return this.media.volume}mute(t){this.media.muted=t||!1===t?t:!this.media.muted}isMuted(){return this.media.muted}getTime(){return this.media.currentTime}setTime(t){this.mediacurrentTime=t||0}getDuration(){return this.media.duration}getDurationMS(){return Math.floor(this.media.duration/60)+":"+("0"+Math.floor(this.media.duration-60*Math.floor(this.media.duration/60))).substr(-2)}setLoop(t){this.media.loop=t}getLoop(){return this.media.loop}},ol.media.Audio=class extends ol.media.Media{constructor(t){t=t||{};var e=new Audio(t.source);e.load(),super({media:e,loop:t.loop})}},ol.source.HexMap=class extends ol.source.ImageCanvas{constructor(t){t=t||{},super({canvasFunction:function(t,e,i,s){return this.drawHex(t,e,i,s)}}),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.grid=t.hexGrid,this.grid.on("change",this.changed.bind(this))}drawHexagon(t,e,i,s,a,o,r){var n;t.beginPath(),o=o||6,r=r||0;for(var h=a=a||0;h<=o;h++)n=this.grid.hex_corner(e,i-r,h),h!=a?t.lineTo(n[0],n[1]):t.moveTo(n[0],n[1]);t.stroke(),s&&t.fill()}showCoordiantes(t){this.coordinates_=t,this.changed()}drawHex(t,e,i,s){var a,o,r,n,h,l=this.canvas.width=s[0],d=this.canvas.height=s[1];this.extent=t;var g=this.grid.getSize()/e;if(g<8){var c=document.createElement("canvas");a=c.getContext("2d");var m=2*Math.sqrt(3)*g*i*10,p=3*g*i*10;c.width=Math.round(m),c.height=Math.round(p),a.scale(i,i),a.lineWidth=1.5,a.fillStyle="transparent";var u=this.grid.coord2hex([t[0],t[3]]);for(o=-10;o<22;o++)for(r=-3;r<22;r++)(n=this.grid.hex2coord([u[0]+o,u[1]+r]))[0]=(n[0]-t[0])/e,n[1]=c.height-(n[1]-t[3])/e,a.strokeStyle="rgba(0,0,0,0.5)",this.drawHexagon(a,n,g,0,3),a.strokeStyle="rgba(255,255,255,0.8)",this.drawHexagon(a,n,g,!1,2,5,2),a.strokeStyle="rgba(0,0,0,0.3)",this.drawHexagon(a,n,g,!1,5,8,2);var f=document.createElement("canvas");a=f.getContext("2d"),f.width=Math.round(l+(m-c.width)*Math.floor(l/c.width)),f.height=Math.round(d+(p-c.height)*Math.floor(d/c.height)),a.fillStyle=a.createPattern(c,"repeat"),a.fillRect(0,0,f.width,f.height),this.context.drawImage(f,0,0,l,d,0,0,f.width,f.height)}else{(a=this.context).save();var v=this.grid.hex2offset(this.grid.coord2hex([t[0],t[1]])),x=this.grid.hex2offset(this.grid.coord2hex([t[2],t[3]]));for(a.scale(i,i),a.lineWidth=1.5,a.textAlign="center",a.textBaseline="middle",a.font="bold 12px Arial",o=v[0]-1;o<=x[0]+1;o++)for(r=v[1]-1;r<=x[1]+1;r++){var y=this.grid.offset2hex([o,r],this.layout_);if((n=this.grid.hex2coord(y))[0]=(n[0]-t[0])/e,n[1]=d/i-(n[1]-t[1])/e,a.strokeStyle="rgba(0,0,0,0.25)",this.drawHexagon(a,n,g),a.strokeStyle="rgba(255,255,255,0.8)",this.drawHexagon(a,n,g,!1,2,5,2),a.strokeStyle="rgba(0,0,0,0.3)",this.drawHexagon(a,n,g,!1,5,8,2),g>20)switch(this.coordinates_){case"axial":a.fillText(y[0]+","+y[1],n[0],n[1]);break;case"cube":h=this.grid.hex2cube(y);for(var S=0;S<3;S++){var w=-Math.PI/180*(120*S+30);a.fillText(h[S],n[0]+Math.cos(w)*g*.5,n[1]+Math.sin(w)*g*.5)}break;case"offset":h=this.grid.hex2offset(y),a.fillText(h[0]+","+h[1],n[0],n[1])}}a.restore()}return this.canvas}},ol.style.Sprite=class extends ol.style.Icon{constructor(t){t=t||{};var e=document.createElement("canvas"),i=e.width=e.height=t.size||64;super({img:e,imgSize:[i,i],scale:t.scale}),this.size=i,this.offset=[0,0];var s,a=this;t.img?s=this.img_=t.img:((s=this.img_=new Image).crossOrigin=t.crossOrigin||"anonymous",s.src=t.src),t.states&&(this.states=t.states),s.width?this.drawImage_():s.onload=function(){a.drawImage_()}}drawImage_(){var t=this.getImage().getContext("2d");t.clearRect(0,0,this.size,this.size),t.drawImage(this.img_,this.offset[0],this.offset[1],this.size,this.size,0,0,this.size,this.size)}setState(t,e){var i=this.states[t]||{},s=[((i.start||0)+Math.trunc(e)%i.length)*(i.size||this.size),(i.line||0)*(i.size||this.size)];return s[0]==this.offset[0]&&s[1]==this.offset[1]||(this.offset=s,this.drawImage_()),e+1>=i.length}setAnchor(t){var e=this.getAnchor();e[0]=t[0]*this.size,e[1]=t[1]*this.size}},ol.style.Sprite.prototype.states={idle:{line:2,length:1},encant_N:{line:0,length:7},encant_W:{line:1,length:7},encant_S:{line:2,length:7},encant_E:{line:3,length:7},thrust_N:{line:4,length:8},thrust_W:{line:5,length:8},thrust_S:{line:6,length:8},thrust_E:{line:7,length:8},walk_N:{line:8,start:1,length:8},walk_W:{line:9,start:1,length:8},walk_S:{line:10,start:1,length:8},walk_E:{line:11,start:1,length:8},slash_N:{line:12,length:6},slash_W:{line:13,length:6},slash_S:{line:14,length:6},slash_E:{line:15,length:6},shoot_N:{line:16,length:13},shoot_W:{line:17,length:13},shoot_S:{line:18,length:13},shoot_E:{line:19,length:13},hurt:{line:20,length:6}},ol.coordinate.projLineRef=function(t,e){var i=t[0]-e[0][0],s=t[1]-e[0][1],a=e[1][0]-e[0][0],o=e[1][1]-e[0][1],r=a*a+o*o;return 0!=r?(i*a+s*o)/r:0},ol.coordinate.projLine=function(t,e){var i=ol.coordinate.projLineRef(t,e);return[e[0][0]+i*(e[1][0]-e[0][0]),e[0][1]+i*(e[1][1]-e[0][1])]},ol.coordinate.projSeg=function(t,e){var i=ol.coordinate.projLineRef(t,e);return i<=0?e[0]:i>=1?e[1]:[e[0][0]+i*(e[1][0]-e[0][0]),e[0][1]+i*(e[1][1]-e[0][1])]},ol.coordinate.revers=function(t){for(var e=[],i=-1;i>=0;i--)e.push(t[i])},ol.geom.LineString.prototype.getCoordinateAtRef=function(t,e){var i,s;if(t<1e-10)return e&&(i=this.getCoordinates(),e[0]=i[0],e[1]=i[1]),this.getFirstCoordinate();if(this.getLength()-t<1e-10)return e&&(i=this.getCoordinates(),e[0]=i[i.length-2],e[1]=i[i.length-1]),this.getLastCoordinate();e||(e=[]);for(var a=0,o=this.getCoordinates(),r=1;r<o.length;r++){if(a+(s=ol.coordinate.dist2d(o[r-1],o[r]))>=t){var n=e[0]=o[r-1],h=e[1]=o[r];return s=ol.coordinate.dist2d(n,h),[n[0]+(t-a)*(h[0]-n[0])/s,n[1]+(t-a)*(h[1]-n[1])/s]}a+=s}},ol.geom.LineString.prototype.lineRef=function(t){for(var e,i,s,a=this.getCoordinates(),o=0,r=1;r<a.length;r++)if(e=a[r-1],i=a[r],(s=ol.coordinate.projLineRef(t,[e,i]))>=0&&s<=1){var n=[e[0]+s*(i[0]-e[0]),e[1]+s*(i[1]-e[1])];if(ol.coordinate.dist2d(t,n)<1e-10)return o+s*ol.coordinate.dist2d(e,i)}else o+=ol.coordinate.dist2d(e,i);return!1},ol.geom.LineString.prototype.sample=function(t,e){e=e||{};var i,s,a,o,r,n=this.getCoordinates(),h=[],l=0,d=0,g=this.getLength();if(g<(e.minLength||0))return[];e.distribute&&(t=(g=this.getLength())>t?g/(g/t|0):g),e.center?(l=g-t*(g/t|0))<1e-10?g>t?l=-t/2:(t=g,l=-g/2):l=l/2-t:h.push(n[0]);for(var c=1;c<n.length;c++){i=n[c-1],s=n[c],r=ol.coordinate.dist2d(i,s);for(var m=t+l-d;m<r;m+=t)a=m/r,o=[i[0]+(s[0]-i[0])*a,i[1]+(s[1]-i[1])*a],h.push(o),l+=t;d+=r}return h};